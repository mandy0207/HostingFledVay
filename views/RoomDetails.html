<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhai+2:wght@500&display=swap" rel="stylesheet">
    <title>Room Details</title>
    <link rel="stylesheet" href="../static/style.css">
    <script src="https://unpkg.com/easyinvoice/dist/easyinvoice.min.js"></script>
</head>
<style>
    #payhere,
    #verify-button1 {
        display: none;
    }
</style>

<body>
    <header class="text-gray-600 body-font navhead">
        <div class="container mx-auto flex flex-wrap p-4 flex-col md:flex-row items-center">
            <a class="flex title-font font-medium items-center text-gray-900 mb-3 md:mb-0">
                <img class="logo" src="../static/pics/logo.png" alt="logo">
                <span class="ml-3 text-xl anchor">FledVay</span>
            </a>
            <nav class="md:mr-auto md:ml-4 md:py-1 md:pl-4 md:border-l md:border-gray-400	flex flex-wrap items-center text-base justify-center">
                <a class="mr-12 text-black anchor" href="home">Home</a>
                <a class="mr-12 text-black anchor" href="about">About</a>
                <a class="mr-12 text-black anchor" href="tracking">Booking</a>
                <a class="mr-12 text-black anchor" href="rooms">Rooms</a>
                <a class="mr-12 text-black anchor">Pages</a>
                <a class="mr-12 text-black anchor" href="contact">Contact</a>
                <div class="dropdown">
                    <a href="home" class="mr-12 text-black anchor">Register</a>
                    <div class="dropdown-content">
                        <a href="Signup" class=" mr-12 dropdowntext text-black anchor">Signup</a>
                        <a href="Login" class="mr-12 dropdowntext text-black anchor">Login</a>
                    </div>

                </div>

            </nav>

        </div>
    </header>
    <section class="text-gray-600 body-font">
        <div class="container px-5 py-4 mx-auto flex flex-wrap">
            <div class="flex flex-wrap -mx-4 mt-auto mb-auto lg:w-1/2 sm:w-2/3 content-start sm:pr-10">
                <div class="w-full sm:p-4 px-4 mb-6">
                    <h1 class="title-font font-medium text-5xl mb-2 text-gray-900" id="HotelName"></h1>
                    <script>
                        document.getElementById("HotelName").innerHTML = localStorage.getItem("hotel");
                    </script>
                    <div class="my-3 text-black-400">Lorem ipsum dolor sit amet consectetur adipisicing elit. Ab unde vitae cumque dignissimos quos consectetur, nostrum temporibus, consequatur quidem, similique debitis quia. Culpa voluptatibus vitae doloribus unde dignissimos soluta
                        molestias! Harum earum accusamus veritatis similique?</div>
                </div>
                <div class="p-4 sm:w-1/2 lg:w-1/4 w-1/2">
                    <h2 class="title-font font-medium text-xl text-gray-900" id="roomtype"></h2>
                    <!-- <p class="leading-relaxed">Room Type</p> -->
                    <script>
                        document.getElementById("roomtype").innerHTML = localStorage.getItem("roomtype")
                    </script>
                </div>
                <div class="p-4 sm:w-1/2 lg:w-1/4 w-1/2">
                    <h2 class="title-font font-medium text-xl text-gray-900" id="bed"></h2>
                    <!-- <p class="leading-relaxed">Bed</p> -->
                    <script>
                        document.getElementById("bed").innerHTML = localStorage.getItem("bed")
                    </script>
                </div>
                <div class="p-4 sm:w-1/2 lg:w-1/4 w-1/2">
                    <h2 class="title-font font-medium text-xl text-gray-900" id="dimensions"></h2>
                    <!-- <p class="leading-relaxed">Services</p> -->
                    <script>
                        document.getElementById("dimensions").innerHTML = localStorage.getItem("dimension")
                    </script>
                </div>
                <div class="p-4 sm:w-1/2 lg:w-1/4 w-1/2">
                    <h2 class="title-font font-medium text-xl text-gray-900" id="price"></h2>
                    <a href="#bringme" class="flex ml-auto text-white bckg border-0 py-1 px-2 focus:outline-none" id="mkpay">Book</a>



                    <!-- <p class="leading-relaxed"><button class="bckg" id="mkpay">Book</button></p> -->
                    <script>
                        document.getElementById("price").innerHTML = localStorage.getItem("price")
                    </script>
                </div>
            </div>
            <div class="lg:w-1/2 sm:w-1/3 w-full rounded-lg overflow-hidden mt-6 sm:mt-0">
                <img class="object-cover object-center w-full h-full" id="dynamicImage" alt="stats">
            </div>
            <script>
                let path = localStorage.getItem("roomimage");
                let link = document.querySelector('#dynamicImage');
                link.setAttribute('src', path)
            </script>
        </div>
    </section>

    <section class="text-gray-600 body-font relative">
        <div class="container px-5 py-24 mx-auto photo3" id="payhere">
            <div class="flex flex-col text-center w-full mb-12">
                <h1 class="sm:text-xl text-xl font-medium title-font mb-4 testhead">Payment Form</h1>
            </div>
            <form action="" method="post">
                <div class="lg:w-1/2 md:w-2/3 mx-auto">
                    <div class="flex flex-wrap -m-2">
                        <div class="p-2 w-1/2">
                            <div class="relative">
                                <label for="name" class="leading-7 text-sm roomtext">Name</label>
                                <input type="text" id="bookingname" name="name" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                                    required>
                            </div>
                            <script>
                                localStorage.setItem("bookingname", document.getElementById("bookingname").innerText)
                            </script>
                        </div>
                        <div class="p-2 w-1/2">
                            <div class="relative">
                                <label for="email" class="leading-7 text-sm roomtext">Email</label>
                                <input type="email" id="bookingemail" name="email" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                                    required>
                            </div>
                            <script>
                                localStorage.setItem("bookingemail", document.getElementById("bookingemail").innerText)
                            </script>
                        </div>

                        <div class="p-2 w-1/2">
                            <div class="relative">
                                <label for="address" class="leading-7 text-sm roomtext">Address</label>
                                <input type="text" id="bookingaddress" name="address" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                                    required>
                            </div>

                        </div>
                        <div class="p-2 w-1/2">
                            <div class="relative">
                                <label for="Phone" class="leading-7 text-sm roomtext">Phone</label>
                                <input type="text" id="bookingphone" name="phone" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"
                                    required>
                            </div>
                        </div>


                        <div class="p-2 w-full" id="bringme">
                            <button class="flex mx-auto text-white bckg border-0 py-2 px-8 focus:outline-none  
                        rounded text-lg" id="rzp-button1">Make Payment</button>

                        </div>

                        <!-- <button class="flex mx-auto text-white bckg border-0 py-2 px-8 focus:outline-none  
        rounded text-lg" id="verify-button1">Confirm Payment</button> -->

                    </div>
                </div>
            </form>
        </div>
    </section>

    <script>
        document.getElementById("mkpay").addEventListener("mouseover", DisplaySetting)

        function DisplaySetting(e) {

            let paysec = document.getElementById("payhere");
            if (paysec.style.display = "none")
                paysec.style.display = "block";

            e.preventDefault();
            var url = "/api/payment/order"
            var params = {
                amount: parseInt(document.getElementById("price").innerText) * 100,
                // amount: 600000,
                currency: "INR",
                receipt: "FledVay",
                payment_capture: "1"
            };

            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function(res) {
                if (xmlHttp.readyState === 4) {
                    res = JSON.parse(xmlHttp.responseText);
                    document.getElementById("rzp-text").value = res.sub.id
                }
            }
            xmlHttp.open("post", url, true);
            xmlHttp.setRequestHeader("Content-type", "application/json");
            xmlHttp.send(JSON.stringify(params));
        }
    </script>


    <div class="containeri" id="para">
        <!-- <label for="">Order id:</label> -->
        <input type="text" name="" id="rzp-text" hidden>
        <br>
        <!-- <button class="flex mx-auto text-white bckg border-0 py-2 px-8 focus:outline-none  
        rounded text-lg" id="rzp-button1">Confirm Payment</button> -->
    </div>
    <div id="paymentDetails"></div>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        document.getElementById("rzp-button1").onclick = function(e) {
            let para1 = document.getElementById('verify-button1');
            if (para1.style.display = "none")
                para1.style.display = "block";

            var options = {
                "key": "rzp_test_thAuSPrJqiCCPR",
                "currency": "INR",
                "name": "Fledvay",
                "description": "Fledvay Transaction",
                "order_id": document.getElementById("rzp-text").value,
                "handler": function(response) {
                    document.getElementById("order-pay-id").value = response.razorpay_payment_id;
                    document.getElementById("order-id").value = response.razorpay_order_id;
                    document.getElementById("order-sig").value = response.razorpay_signature;
                },
                "theme": {
                    "color": "rgb(54, 54, 133)"
                }
            };
            var rzpl = new Razorpay(options);
            rzpl.open();
            e.preventDefault();
        }
    </script>
    <button class="flex mx-auto text-white bckg border-0 py-2 px-8 focus:outline-none  
    rounded text-lg" id="verify-button1">Confirm Payment</button>
    <div class="containeri" id="para1">
        <!-- <div> <label for="">Order id:</label> -->
        <input type="text" id="order-id" hidden></div>
    <div>
        <!-- <label for="">Payment id:</label> -->
        <input type="text" id="order-pay-id" hidden></div>
    <!-- <div> <label for="">Order signature:</label> -->
    <input type="text" id="order-sig" hidden></div>



    </div>
    <script>
        document.getElementById('verify-button1').onclick = function(e) {
            var url = '/api/payment/verify';
            var params = {
                razorpay_order_id: document.getElementById('order-id').value,
                razorpay_payment_id: document.getElementById('order-pay-id').value,
                razorpay_signature: document.getElementById('order-sig').value,
                bookingEmail: document.getElementById('bookingemail').value,
                name: document.getElementById('bookingname').value,
                address: document.getElementById("bookingaddress").value,
                phone: document.getElementById("bookingphone").value,
                hotel: localStorage.getItem("hotel"),
                checkin: localStorage.getItem("checkin"),
                checkout: localStorage.getItem("checkout")

            };
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function(res) {
                if (xmlHttp.readyState === 4) {
                    // alert(xmlHttp.responseText);
                    document.body.innerHTML = xmlHttp.responseText;
                    console.log(params.name);
                    document.getElementById("Download").addEventListener("click", GetTicket)

                    function GetTicket(e) {
                        var data = {
                            "currency": "INR",
                            "taxNotation": "vat",
                            "marginTop": 25,
                            "marginRight": 25,
                            "marginLeft": 25,
                            "marginBottom": 25,
                            "logo": "https://public.easyinvoice.cloud/img/logo_en_original.png",
                            "sender": {
                                "company": "Fledvay",
                                "address": "Boulevard Pierrefonds",
                                "zip": "1234 AB",
                                "city": "Montreal",
                                "country": "Canada"
                            },
                            "client": {
                                "company": params.name,
                                "address": params.address,
                                "zip": "4567 CD",
                                "city": "Clientcity",
                                "country": "Clientcountry",
                            },
                            "invoiceNumber": "2021.0001",
                            "invoiceDate": "1.1.2021",
                            "products": [{
                                "quantity": "1",
                                "description": localStorage.getItem("hotel"),
                                "tax": 10,
                                "price": localStorage.getItem("price")
                            }],
                            "bottomNotice": "Thanks for using Fledvay",

                        };
                        easyinvoice.createInvoice(data, function(result) {
                            console.log(result.pdf);
                            easyinvoice.download('myInvoice.pdf', result.pdf);
                        });
                    }

                }
            }

            xmlHttp.open("POST", url, true);
            xmlHttp.setRequestHeader("Content-type", "application/json");
            xmlHttp.send(JSON.stringify(params));
        }
    </script>


</body>

</html>